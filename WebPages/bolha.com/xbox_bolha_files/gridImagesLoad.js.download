$.fn.isInViewPort = function(){
	var win = $(window);
	var viewport = {
		top : win.scrollTop(),
		left : win.scrollLeft()
	};

	viewport.right = viewport.left + win.width();
	viewport.bottom = viewport.top + win.height();

	var bounds = this.offset();
	bounds.right = bounds.left + this.outerWidth();
	bounds.bottom = bounds.top + this.outerHeight();

	return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));
};


function replaceAttributeContent(ReplaceWhichContent, className, element, timeout) {
	setTimeout(function(){
		$(element+className).each(function() {
			if ($(this).isInViewPort() && $(this).attr("data-original")) {
				$(this).attr(ReplaceWhichContent, $(this).attr("data-original"));
				$(this).removeAttr("data-original");
				$(this).removeClass(className);
			}
		});
	},timeout);
}


/**
 * Follow redBox and grid view
 * 
 * @param event
 */
function showImagesOnScroll(event) {
	replaceAttributeContent("style", ".lazyGrid", "div", 0);
	replaceAttributeContent("src", ".lazyRedBox", "img", 0);
	replaceAttributeContent("style", ".lazyRedBox", "div", 500);
}


function checkArrowKeys(e) {
	e = e || window.event;
	if(e.keyCode == 40 
			|| e.keyCode == 38 
			|| e.keyCode == 34 
			|| e.keyCode == 33) 
	{
		showImagesOnScroll();
	}
}


/**
 * Attach events
 */
$(function() {
	
	showImagesOnScroll();

	/*
	if (window.addEventListener)
		window.addEventListener('DOMMouseScroll', showImagesOnScroll, false);

	// On mouse wheel
	window.onmousewheel = document.onmousewheel = showImagesOnScroll;
	 */

	window.onscroll = showImagesOnScroll;

	/*
	$(document).on("scroll", function(e){
		setTimeout(function(){
			showImagesOnScroll();
		},200);
	});
	*/

	// On arrow keys pressed
	document.onkeydown = checkArrowKeys;
});